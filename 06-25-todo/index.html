<!doctype html>
<html>

  <head>
    <meta charset="utf-8">
    <title>VanillaJS � TodoMVC</title>
    <link rel="stylesheet" href="./static/base.css">
    <link rel="stylesheet" href="./static/index.css">
  </head>

  <body>
    <label for="todo-write">할일 목록 정하기</label>
    <input id="todo-write" type="text"><button type="button" id="todoCreate">등록</button>
    <div class="todo-list">
      
    </div>
    <button class="todo-all" type="button">전체목록</button>
    <button class="todo-active" type="button">active</button>
    <button class="todo-completed" type="button">completed</button>
    <script>
      var data = [];

      function selector(target) {
        $target = document.querySelector(target);
        return $target;
      }

      function initInput(target) {
        selector(target).value = '';
      }

      function inputValue(target) {
        return selector(target).value;
      }

      function create() {
        const inputTarget = '#todo-write';
        const id = '_' + Math.random().toString(36).substr(2, 9);
        const done = false;
        const newData = inputValue(inputTarget);
        newTodo = {id: id, todo: newData, done: done};
        data.push(newTodo);
        initInput(inputTarget);
        render('.todo-list');
      }

      function read() {
        return data;
      }

      function updateTodo(e) {
        const id = e.target.getAttribute('data-id');
        const newValue = inputValue(`#todo${id}`);
        data[id].todo = newValue;
        render();
      }

      function del(e) {
        const id = e.target.getAttribute('data-id');
        data.splice(id, 1);
        render();
      }
            
      function reset() {
        data = [];
        render();
      }

      function isDone(e) {
        const id = e.target.getAttribute('data-id');
        newValue = e.target.innerHTML === 'completed' ? true : false;
        data[id].done = newValue;
        render();
      }

      function render() {
        $domTemplate = selector('.todo-list');
        $domTemplate.innerHTML = ''
        $domTemplate.innerHTML = data.length === 0 ? '목록이 없습니다.' : HtmlRender(data);
      }

      function activeRender() {
        const activeData = data.filter(item => item.done === false);
        $domTemplate = selector('.todo-list');
        $domTemplate.innerHTML = ''
        $domTemplate.innerHTML = HtmlRender(activeData);
      }

      function completedRender() {
        const completedData = data.filter(item => item.done !== false);
        $domTemplate = selector('.todo-list');
        $domTemplate.innerHTML = ''
        $domTemplate.innerHTML = HtmlRender(completedData);
      }

      function HtmlRender(target) {
        return target.map((item, index) => {
          const elemAll = `<button id="done${index}" type="button" data-id="${index}" onclick="isDone(event)">${item.done === false ? 'completed' : 'todo'}</button>
          <button type="button" data-id="${index}" onclick="updateTodo(event)">수정</button>
          <button type="button" data-id="${index}" onclick="del(event)">삭제</button>`
          return `<p>
            <input id="todo${index}" value="${item.todo}" data-id="${index}">
            ${target === data ? elemAll : ''}
          </p>`;
        })
      }

      selector('#todoCreate').addEventListener('click', create);
      selector('.todo-all').addEventListener('click', render);
      selector('.todo-active').addEventListener('click', activeRender);
      selector('.todo-completed').addEventListener('click', completedRender);
      render();
    </script>
  </body>

</html>